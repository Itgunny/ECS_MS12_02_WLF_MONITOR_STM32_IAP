###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.50.1.4415/W32 for ARM      26/Feb/2013  16:44:26 #
# Copyright 1999-2012 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Tools\IAR Systems\Embedded Workbench                  #
#                    6.5\WorkSpace\WL9F_Display_IAP\Platform\SRC\main.c       #
#    Command line =  "C:\Tools\IAR Systems\Embedded Workbench                 #
#                    6.5\WorkSpace\WL9F_Display_IAP\Platform\SRC\main.c" -D   #
#                    USE_STDPERIPH_DRIVER -D STM32F4XX -D USE_STM324xG_EVAL   #
#                    -lcN "C:\Tools\IAR Systems\Embedded Workbench            #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\Debug\List\" -o   #
#                    "C:\Tools\IAR Systems\Embedded Workbench                 #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\Debug\Obj\"       #
#                    --debug --endian=little --cpu=Cortex-M4 -e               #
#                    --fpu=VFPv4_sp --dlib_config "C:\Tools\IAR               #
#                    Systems\Embedded Workbench 6.5\arm\INC\c\DLib_Config_Ful #
#                    l.h" -I "C:\Tools\IAR Systems\Embedded Workbench         #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\..\Platform\INC\" #
#                     -I "C:\Tools\IAR Systems\Embedded Workbench             #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\..\Libraries\CMSI #
#                    S\Device\ST\STM32F4xx\Include\" -I "C:\Tools\IAR         #
#                    Systems\Embedded Workbench 6.5\WorkSpace\WL9F_Display_IA #
#                    P\Project\..\Libraries\STM32F4xx_StdPeriph_Driver\inc\"  #
#                    -I "C:\Tools\IAR Systems\Embedded Workbench              #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\..\Utilities\STM3 #
#                    2_EVAL\Common\" -I "C:\Tools\IAR Systems\Embedded        #
#                    Workbench 6.5\WorkSpace\WL9F_Display_IAP\Project\..\Util #
#                    ities\STM32_EVAL\STM3240_41_G_EVAL\" -Oh                 #
#                    --use_c++_inline -I "C:\Tools\IAR Systems\Embedded       #
#                    Workbench 6.5\arm\CMSIS\Include\"                        #
#    List file    =  C:\Tools\IAR Systems\Embedded Workbench                  #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\Debug\List\main.l #
#                    st                                                       #
#    Object file  =  C:\Tools\IAR Systems\Embedded Workbench                  #
#                    6.5\WorkSpace\WL9F_Display_IAP\Project\Debug\Obj\main.o  #
#                                                                             #
#                                                                             #
###############################################################################

C:\Tools\IAR Systems\Embedded Workbench 6.5\WorkSpace\WL9F_Display_IAP\Platform\SRC\main.c
      1          /**
      2            ******************************************************************************
      3            * @file    STM32F4xx_IAP/src/main.c 
      4            * @author  MCD Application Team
      5            * @version V1.0.0
      6            * @date    10-October-2011
      7            * @brief   Main program body
      8            ******************************************************************************
      9            * @attention
     10            *
     11            * THE PRESENT FIRMWARE WHICH IS FOR GUIDANCE ONLY AIMS AT PROVIDING CUSTOMERS
     12            * WITH CODING INFORMATION REGARDING THEIR PRODUCTS IN ORDER FOR THEM TO SAVE
     13            * TIME. AS A RESULT, STMICROELECTRONICS SHALL NOT BE HELD LIABLE FOR ANY
     14            * DIRECT, INDIRECT OR CONSEQUENTIAL DAMAGES WITH RESPECT TO ANY CLAIMS ARISING
     15            * FROM THE CONTENT OF SUCH FIRMWARE AND/OR THE USE MADE BY CUSTOMERS OF THE
     16            * CODING INFORMATION CONTAINED HEREIN IN CONNECTION WITH THEIR PRODUCTS.
     17            *
     18            * <h2><center>&copy; COPYRIGHT 2011 STMicroelectronics</center></h2>
     19            ******************************************************************************
     20            */ 
     21          
     22          /** @addtogroup STM32F4xx_IAP
     23            * @{
     24            */
     25          
     26          /* Includes ------------------------------------------------------------------*/
     27          #include "menu.h"
     28          #include "stm324xg_eval.h"
     29          
     30          /* Private typedef -----------------------------------------------------------*/
     31          /* Private define ------------------------------------------------------------*/
     32          /* Private macro -------------------------------------------------------------*/
     33          /* Private variables ---------------------------------------------------------*/
     34          extern pFunction Jump_To_Application;
     35          extern uint32_t JumpAddress;
     36          
     37          /* Private function prototypes -----------------------------------------------*/
     38          static void IAP_Init(void);
     39          
     40          /* Private functions ---------------------------------------------------------*/
     41          
     42          /**
     43            * @brief  Main program.
     44            * @param  None
     45            * @retval None
     46            */
     47          int main(void)
     48          {
     49            /* Unlock the Flash Program Erase controller */
     50            FLASH_If_Init();
     51          
     52            /* Initialize Key Button mounted on STM324xG-EVAL board */
     53            STM_EVAL_PBInit(BUTTON_KEY, BUTTON_MODE_GPIO);
     54          
     55            /* Test if Key push-button on STM324xG-EVAL Board is pressed */
     56            if (STM_EVAL_PBGetState(BUTTON_KEY) == 0x00)
     57            { 
     58              /* Execute the IAP driver in order to reprogram the Flash */
     59              IAP_Init();
     60              /* Display main menu */
     61              Main_Menu ();
     62            }
     63            /* Keep the user application running */
     64            else
     65            {
     66              /* Test if user code is programmed starting from address "APPLICATION_ADDRESS" */
     67              if (((*(__IO uint32_t*)APPLICATION_ADDRESS) & 0x2FFE0000 ) == 0x20000000)
     68              { 
     69                /* Jump to user application */
     70                JumpAddress = *(__IO uint32_t*) (APPLICATION_ADDRESS + 4);
     71                Jump_To_Application = (pFunction) JumpAddress;
     72                /* Initialize user application's Stack Pointer */
     73                __set_MSP(*(__IO uint32_t*) APPLICATION_ADDRESS);
     74                Jump_To_Application();
     75              }
     76            }
     77          
     78            while (1)
     79            {}
     80          }
     81          
     82          /**
     83            * @brief  Initialize the IAP: Configure USART.
     84            * @param  None
     85            * @retval None
     86            */
     87          void IAP_Init(void)
     88          {
     89           USART_InitTypeDef USART_InitStructure;
     90          
     91            /* USART resources configuration (Clock, GPIO pins and USART registers) ----*/
     92            /* USART configured as follow:
     93                  - BaudRate = 115200 baud  
     94                  - Word Length = 8 Bits
     95                  - One Stop Bit
     96                  - No parity
     97                  - Hardware flow control disabled (RTS and CTS signals)
     98                  - Receive and transmit enabled
     99            */
    100            USART_InitStructure.USART_BaudRate = 115200;
    101            USART_InitStructure.USART_WordLength = USART_WordLength_8b;
    102            USART_InitStructure.USART_StopBits = USART_StopBits_1;
    103            USART_InitStructure.USART_Parity = USART_Parity_No;
    104            USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
    105            USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
    106          
    107            STM_EVAL_COMInit(COM1, &USART_InitStructure);
    108          }
    109          
    110          #ifdef USE_FULL_ASSERT
    111          /**
    112            * @brief  Reports the name of the source file and the source line number
    113            *         where the assert_param error has occurred.
    114            * @param  file: pointer to the source file name
    115            * @param  line: assert_param error line source number
    116            * @retval None
    117            */
    118          void assert_failed(uint8_t* file, uint32_t line)
    119          {
    120            /* User can add his own implementation to report the file name and line number,
    121               ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
    122          
    123            /* Infinite loop */
    124            while (1)
    125            {
    126            }
    127          }
    128          #endif
    129          
    130          /**
    131            * @}
    132            */
    133          
    134          /******************* (C) COPYRIGHT 2011 STMicroelectronics *****END OF FILE****/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
      24   main
        24   -- Indirect call
        24   -> FLASH_If_Init
        24   -> Main_Menu
        24   -> STM_EVAL_COMInit
        24   -> STM_EVAL_PBGetState
        24   -> STM_EVAL_PBInit


   Section sizes:

   Bytes  Function/Label
   -----  --------------
     116  main

 
 116 bytes in section .text
 
 116 bytes of CODE memory

Errors: none
Warnings: none
